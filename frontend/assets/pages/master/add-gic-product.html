<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add GIC Product</title>

<style>
    body{
        font-family: Arial, sans-serif;
        background:#f4f6f9;
        padding:20px;
    }

    h2{
        margin-bottom:14px;
    }

    .form-box,.table-box{
        background:#fff;
        padding:22px;
        border-radius:8px;
        box-shadow:0 2px 6px rgba(0,0,0,0.1);
        max-width:900px;
        margin-bottom:24px;
    }

    /* ===== TWO COLUMN FORM ===== */
    .form-grid{
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:16px 18px;
    }

    .full{
        grid-column:span 2;
    }

    label{
        font-weight:600;
        font-size:14px;
        margin-bottom:6px;
        display:block;
    }

    input,select{
        width:100%;
        padding:10px;
        border-radius:6px;
        border:1px solid #ccc;
        font-size:14px;
    }

    .btn-row{
        margin-top:18px;
        display:flex;
        gap:10px;
    }

    .btn{
        padding:10px 18px;
        background:#013859;
        color:#fff;
        border:none;
        border-radius:6px;
        cursor:pointer;
    }

    .btn-new{
        background:#ff9800;
    }

    table{
        width:100%;
        border-collapse:collapse;
        margin-top:15px;
    }

    th,td{
        padding:10px;
        border-bottom:1px solid #ddd;
        text-align:center;
        font-size:14px;
    }

    th{
        background:#f8f9fa;
    }

    .edit-btn{
        background:#4CAF50;
        color:#fff;
        border:none;
        padding:6px 10px;
        border-radius:4px;
        cursor:pointer;
    }

    .delete-btn{
        background:#d9534f;
        color:#fff;
        border:none;
        padding:6px 10px;
        border-radius:4px;
        cursor:pointer;
    }
</style>
</head>

<body>

<h2>Add GIC Product</h2>

<!-- ================= FORM ================= -->
<div class="form-box">
    <div class="form-grid">

        <div>
            <label>S.No *</label>
            <input id="sno" readonly>
        </div>

        <div>
            <label>Status *</label>
            <select id="status">
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
            </select>
        </div>

        <div class="full">
            <label>GIC Product Name *</label>
            <input id="gic" placeholder="e.g. Car Insurance, Bike Insurance">
        </div>

        <div class="full">
            <label>Date</label>
            <input id="date" readonly>
        </div>

    </div>

    <div class="btn-row">
        <button class="btn" onclick="saveGIC()">Save</button>
        <button class="btn btn-new" onclick="resetForm()">Add New</button>
    </div>
</div>

<!-- ================= TABLE ================= -->
<div class="table-box">
    <h3>GIC Product Records</h3>
    <table>
        <thead>
            <tr>
                <th>S.No</th>
                <th>GIC Product Name</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>
</div>

<script>
const TYPE="gicproduct";
const API=`/api/master/item/${TYPE}`;
let editId=null;

/* DATE */
function loadDate(){
    document.getElementById("date").value=
        new Date().toISOString().split("T")[0];
}

/* SNO */
async function loadSno(){
    try{
        const r=await fetch(API);
        const j=await r.json();
        document.getElementById("sno").value=
            (j.data && j.data.length ? j.data.length:0)+1;
    }catch{
        document.getElementById("sno").value=1;
    }
}

/* RESET */
function resetForm(){
    editId=null;
    document.getElementById("gic").value="";
    document.getElementById("status").value="Active";
    loadDate();loadSno();
}

/* SAVE */
async function saveGIC(){
    const name=document.getElementById("gic").value.trim();
    if(!name){alert("GIC Product Name Required");return;}

    const payload={
        s_no:document.getElementById("sno").value,
        name,
        meta:{gic:name},
        status:document.getElementById("status").value,
        date:document.getElementById("date").value
    };

    const url=editId?`${API}/${editId}`:API;
    const method=editId?"PUT":"POST";

    const r=await fetch(url,{
        method,
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(payload)
    });
    const j=await r.json();
    if(j.success){resetForm();loadList();}
    else alert(j.message||"Save failed");
}

/* LIST */
async function loadList(){
    const r=await fetch(API);
    const j=await r.json();
    const tb=document.getElementById("tbody");
    tb.innerHTML="";
    if(!j.data||!j.data.length){
        tb.innerHTML=`<tr><td colspan="5">No records found</td></tr>`;
        return;
    }
    j.data.forEach(i=>{
        tb.innerHTML+=`
        <tr>
            <td>${i.s_no}</td>
            <td>${i.meta.gic}</td>
            <td>${i.status}</td>
            <td>${i.date}</td>
            <td>
                <button class="edit-btn" onclick="editItem('${i._id}')">Edit</button>
                <button class="delete-btn" onclick="deleteItem('${i._id}')">Delete</button>
            </td>
        </tr>`;
    });
}

/* EDIT */
async function editItem(id){
    const r=await fetch(API);
    const j=await r.json();
    const i=j.data.find(x=>x._id===id);
    if(!i)return;
    editId=id;
    document.getElementById("sno").value=i.s_no;
    document.getElementById("gic").value=i.meta.gic;
    document.getElementById("status").value=i.status;
    document.getElementById("date").value=i.date;
    window.scrollTo({top:0,behavior:"smooth"});
}

/* DELETE */
async function deleteItem(id){
    if(!confirm("Delete this GIC Product?"))return;
    await fetch(`${API}/${id}`,{method:"DELETE"});
    loadList();loadSno();
}

/* INIT */
loadDate();loadSno();loadList();
</script>

</body>
</html>
