<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add Fuel â€“ Master CRM</title>

<link rel="stylesheet" href="../../assets/css/main.css">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f6f9;
        padding: 20px;
    }

    h2 {
        margin-bottom: 15px;
    }

    .form-box, .table-box {
        background: #ffffff;
        padding: 22px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        max-width: 900px;
        margin: 0 auto 25px auto;
    }

    /* ---------- 2 COLUMN FORM ---------- */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }

    label {
        font-weight: bold;
        margin-bottom: 6px;
        display: block;
    }

    input, select {
        width: 100%;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: #f8fafc;
    }

    .full {
        grid-column: span 2;
    }

    .btn {
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: bold;
    }

    .btn-save { background: #013859; color: #fff; }
    .btn-new { background: #ff9800; color: #fff; margin-left: 8px; }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: center;
    }

    th {
        background: #f1f5f9;
    }

    .edit-btn {
        background: #22c55e;
        color: #fff;
        padding: 6px 10px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        margin-right: 5px;
    }

    .delete-btn {
        background: #ef4444;
        color: #fff;
        padding: 6px 10px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
    }
</style>
</head>

<body>

<h2>Add Fuel Master</h2>

<!-- ================= FORM ================= -->
<div class="form-box">
    <div class="form-grid">

        <div>
            <label>S.No *</label>
            <input id="sno" readonly>
        </div>

        <div>
            <label>Fuel *</label>
            <input id="fuel" placeholder="Petrol / Diesel / CNG">
        </div>

        <div>
            <label>Status *</label>
            <select id="status">
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
            </select>
        </div>

        <div>
            <label>Date *</label>
            <input id="date" readonly>
        </div>

        <div class="full">
            <button class="btn btn-save" onclick="saveFuel()">Save</button>
            <button class="btn btn-new" onclick="resetForm()">Add New</button>
        </div>

    </div>
</div>

<!-- ================= TABLE ================= -->
<div class="table-box">
    <h3>Fuel Records</h3>
    <table>
        <thead>
            <tr>
                <th>S.No</th>
                <th>Fuel</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="fuelTbody"></tbody>
    </table>
</div>

<script>
const API = "/api/master/item/fuel";
let editId = null;

/* ---------- INIT ---------- */
document.addEventListener("DOMContentLoaded", () => {
    loadDate();
    loadFuelList();
});

/* ---------- DATE ---------- */
function loadDate() {
    document.getElementById("date").value =
        new Date().toISOString().split("T")[0];
}

/* ---------- RESET ---------- */
function resetForm() {
    editId = null;
    document.getElementById("fuel").value = "";
    document.getElementById("status").value = "Active";
    loadDate();
    loadFuelList();
}

/* ---------- LOAD LIST ---------- */
async function loadFuelList() {
    const tbody = document.getElementById("fuelTbody");
    tbody.innerHTML = `<tr><td colspan="5">Loading...</td></tr>`;

    try {
        const res = await fetch(API);
        const json = await res.json();

        tbody.innerHTML = "";

        if (!json.data || json.data.length === 0) {
            tbody.innerHTML =
                `<tr><td colspan="5">No records found</td></tr>`;
            document.getElementById("sno").value = 1;
            return;
        }

        json.data.forEach((item, index) => {
            tbody.innerHTML += `
                <tr>
                    <td>${item.s_no || index + 1}</td>
                    <td>${item.name}</td>
                    <td>${item.status}</td>
                    <td>${item.date}</td>
                    <td>
                        <button class="edit-btn" onclick="editFuel('${item._id}')">Edit</button>
                        <button class="delete-btn" onclick="deleteFuel('${item._id}')">Delete</button>
                    </td>
                </tr>
            `;
        });

        document.getElementById("sno").value = json.data.length + 1;

    } catch {
        tbody.innerHTML =
            `<tr><td colspan="5" style="color:red;">Failed to load</td></tr>`;
        document.getElementById("sno").value = 1;
    }
}

/* ---------- SAVE / UPDATE ---------- */
async function saveFuel() {
    const fuel = document.getElementById("fuel").value.trim();
    const status = document.getElementById("status").value;
    const date = document.getElementById("date").value;

    if (!fuel) {
        alert("Fuel is required");
        return;
    }

    const payload = {
        name: fuel,
        fuel: fuel,
        status,
        date
    };

    const url = editId ? `${API}/${editId}` : API;
    const method = editId ? "PUT" : "POST";

    const res = await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    const json = await res.json();

    if (json.success) {
        alert(editId ? "Updated successfully" : "Saved successfully");
        resetForm();
    } else {
        alert(json.message || "Save failed");
    }
}

/* ---------- EDIT ---------- */
async function editFuel(id) {
    const res = await fetch(API);
    const json = await res.json();

    const item = json.data.find(x => x._id === id);
    if (!item) return;

    editId = id;
    document.getElementById("sno").value = item.s_no;
    document.getElementById("fuel").value = item.name;
    document.getElementById("status").value = item.status;
    document.getElementById("date").value = item.date;

    window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ---------- DELETE ---------- */
async function deleteFuel(id) {
    if (!confirm("Delete this fuel?")) return;

    const res = await fetch(`${API}/${id}`, { method: "DELETE" });
    const json = await res.json();

    if (json.success) {
        alert("Deleted successfully");
        loadFuelList();
    } else {
        alert("Delete failed");
    }
}
</script>

</body>
</html>